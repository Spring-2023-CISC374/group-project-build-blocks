var f=Object.defineProperty;var k=(c,o,t)=>o in c?f(c,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[o]=t;var i=(c,o,t)=>(k(c,typeof o!="symbol"?o+"":o,t),t);import{C as I,a as g,P as _,b as x,B as y,c as R,d as w}from"./Crane.a4e637f4.js";class D extends I{constructor(){super(...arguments);i(this,"visitProgram");i(this,"visitStatement");i(this,"visitLoopStatement");i(this,"visitMoveStatement");i(this,"visitActionStatement");i(this,"visitGrabAction");i(this,"visitReleaseAction")}}class E extends D{constructor(t,e){super();i(this,"output");i(this,"indent");i(this,"scene");i(this,"timing");i(this,"visitProgram",t=>{this.indent=0,this.output&&(this.output.innerHTML=""),this.visitChildren(t)});i(this,"visitStatement",t=>{this.output&&(this.output.innerHTML+=`${"&nbsp;".repeat(this.indent*4)}visitStatement ${t.getText()}<br>`),this.visitChildren(t)});i(this,"visitLoopStatement",t=>{this.output&&(this.output.innerHTML+=`${"&nbsp;".repeat(this.indent*4)}visitLoopStatement ${t.getText()}<br>`);for(let e=0;e<parseInt(t.getChild(1).getText());e++)this.visitChildren(t)});i(this,"visitActionStatement",t=>{var e,s;switch(this.output&&(this.output.innerHTML+=`${"&nbsp;".repeat(this.indent*4)}visitActionStatement ${t.getText()}<br>`),t.getText()){case"open":case"release":(e=this.scene)==null||e.time.delayedCall(this.timing,()=>{var n;(n=this.scene)==null||n.getCrane.release()}),this.timing+=g.MOVEMENT_TIME+500,console.log("open",this.timing);break;case"close":case"grab":(s=this.scene)==null||s.time.delayedCall(this.timing,()=>{var n;(n=this.scene)==null||n.getCrane.grab()}),this.timing+=g.MOVEMENT_TIME+500,console.log("close",this.timing);break}});i(this,"visitMoveStatement",t=>{var e,s,n,r,l;switch(this.output&&(this.output.innerHTML+=`${"&nbsp;".repeat(this.indent*4)}visitMoveStatement ${t.getText()}<br>`),console.log((e=this.scene)==null?void 0:e.getCrane),t.getText()){case"up":(s=this.scene)==null||s.time.delayedCall(this.timing,()=>{var a;(a=this.scene)==null||a.getCrane.moveUp()}),this.timing+=g.MOVEMENT_TIME+500,console.log("move up",this.timing);break;case"down":(n=this.scene)==null||n.time.delayedCall(this.timing,()=>{var a;(a=this.scene)==null||a.getCrane.moveDown()}),this.timing+=g.MOVEMENT_TIME+500,console.log("move down",this.timing);break;case"left":(r=this.scene)==null||r.time.delayedCall(this.timing,()=>{var a;(a=this.scene)==null||a.getCrane.moveLeft()}),this.timing+=g.MOVEMENT_TIME+500,console.log("move leftr",this.timing);break;case"right":(l=this.scene)==null||l.time.delayedCall(this.timing,()=>{var a;(a=this.scene)==null||a.getCrane.moveRight()}),this.timing+=g.MOVEMENT_TIME+500,console.log("move roigiht",this.timing);break;default:console.error("visitMoveStatement: invalid move statement",t.getText());break}console.log("visitMoveStatement",t.getText()),this.visitChildren(t)});this.indent=0,this.output=t,this.scene=e,this.timing=0}}class p extends Phaser.GameObjects.Image{constructor(t,e,s,n,r){var o=(...args)=>{super(...args);i(this,"instructionType");i(this,"instructionText");i(this,"loopChild");i(this,"loopNumber");i(this,"nextInstruction");i(this,"previousInstruction")};n==="number"&&r?(o(t,e,s,"instruction-number"),this.loopNumber=r,this.instructionText=t.add.text(e-6,s-9,r.toString(),{color:"black",fontSize:"18px",align:"left"}),this.instructionText.depth=999):n==="loop"?(o(t,e,s,"instruction-loop"),this.instructionText=t.add.text(e-44,s-13,n,{color:"black",fontSize:"18px",align:"left"}),this.instructionText.depth=999):(o(t,e,s,"instruction"),this.instructionText=t.add.text(e-44,s-13,n,{color:"black",fontSize:"18px",align:"left"}),this.instructionText.depth=999),this.instructionType=n,this.setInteractive(),t.input.setDraggable(this),this.input.dropZone=!0,this.on("pointerover",()=>{this.setTint(4521796)}),this.on("pointerout",()=>{this.clearTint()}),t.input.on("drag",this.handleDrag,this),t.input.on("drop",this.handleDrop,this)}handleDrag(t,e,s,n){this!==e&&(this.scene.children.bringToTop(this),this.loopChild&&this.scene.children.bringToTop(this.loopChild)),this===e&&(this.previousInstruction&&(this.instructionType==="number"?this.previousInstruction.loopChild=void 0:this.previousInstruction.nextInstruction=void 0,this.previousInstruction=void 0),this.moveInstruction(s,n)),this.instructionText.depth=999}moveInstruction(t,e){this.x=t,this.y=e,this.instructionType!=="number"?(this.instructionText.x=t-44,this.instructionText.y=e-13):(this.instructionText.x=t-6,this.instructionText.y=e-18/2),this.nextInstruction!==void 0&&this.nextInstruction.moveInstruction(t,e+31),this.loopChild!==void 0&&this.loopChild.moveInstruction(t+11,e-4)}snapIntoPlace(){this.previousInstruction&&this.moveInstruction(this.previousInstruction.x,this.previousInstruction.y+31)}handleDrop(t,e,s){this.instructionText.depth=999,e===this&&s instanceof p&&s!==this&&s.instructionType!=="number"&&(this.instructionType==="number"?s.instructionType==="loop"&&s.loopChild===void 0&&(this.previousInstruction=s,this.previousInstruction.loopChild=this,this.moveInstruction(this.previousInstruction.x+11,this.previousInstruction.y-4),this.scene.children.bringToTop(this)):this.previousInstruction===void 0&&s.nextInstruction===void 0&&(this.previousInstruction=s,this.previousInstruction.nextInstruction=this,this.snapIntoPlace()))}}class T extends _.Physics.Arcade.Sprite{constructor(t,e,s,n,r,l){super(t,e,s,n,l);i(this,"color");this.color=r,this.setColor(r),t.add.existing(this),t.physics.add.existing(this)}setColor(t){switch(this.color=t,this.color){case"brown":this.clearTint();break;case"red":this.setTint(16711680);break;case"green":this.setTint(65280);break;case"blue":this.setTint(671487);break;default:this.clearTint();break}}getColor(){return this.color}checkOverlap(t){const e=Math.abs(this.body.position.x-t.body.position.x),s=Math.abs(this.body.position.y-t.body.position.y),n=Math.sqrt(e*e+s*s);return console.log(n),n<.1}}function m(c,o,t,e){return{GRID_START_BOTTOM:c,GRID_START_LEFT:o,GRID_SQUARE_SIZE:t,GRID_END_RIGHT:o+t*e.width,GRID_END_TOP:c+t*e.height,GRID_MID_HORIZONTAL:(o+t*e.width+o)/2,GRID_MID_VERTICAL:(c+t*e.height+c)/2}}class S{constructor(o,t,e){i(this,"scene");i(this,"gridData");i(this,"isPrimaryGrid");i(this,"gridSquares");i(this,"crane");i(this,"crates");i(this,"endCrates");i(this,"toggleVisibleButton");i(this,"gridVars");i(this,"isVisible");i(this,"maxScore");this.scene=e,this.isPrimaryGrid=t,this.gridData=o,this.isPrimaryGrid?this.gridVars=m(h.P_GRID_START_BOTTOM,h.P_GRID_START_LEFT,h.P_GRID_SQUARE_SIZE,o):this.gridVars=m(h.S_GRID_START_BOTTOM,h.S_GRID_START_LEFT,h.S_GRID_SQUARE_SIZE,o),this.isVisible=!0,t&&this.getMaxScore()}getGoalText(){let o=`GOAL
`;const t=`
E = empty
C = crane
T = tan
R = Red
G = green
B = blue`,e={none:"E","crate-brown":"T","crate-red":"R","crate-green":"G","crate-blue":"B",crane:"C"};for(let s=0;s<this.gridData.gridObjectives.length;s++){for(let n=0;n<this.gridData.gridObjectives[s].length;n++)o+=(e[this.gridData.gridObjectives[s][n]]||"?")+" ";o+=`
`}return o+=t,o}makeGrid(){var o;for(let t=0;t<this.gridData.width;t++){const e=[];for(let s=0;s<this.gridData.height;s++){const n=this.scene.add.image(this.gridVars.GRID_START_LEFT+this.gridVars.GRID_SQUARE_SIZE*t,this.scene.sys.game.canvas.height-this.gridVars.GRID_START_BOTTOM-this.gridVars.GRID_SQUARE_SIZE*s,"gridSquare");e.push(n)}(o=this.gridSquares)==null||o.push(e)}this.endCrates=this.placeBlocks(!1),this.endCrates.setAlpha(.5),this.isPrimaryGrid&&(this.crates=this.placeBlocks(!0),this.toggleVisibleButton=this.scene.add.sprite(this.gridVars.GRID_MID_HORIZONTAL,this.scene.sys.game.canvas.height-(this.gridVars.GRID_END_TOP+20),"visibilityButton").setFrame(1),this.toggleVisibleButton.setInteractive(),this.toggleVisibleButton.on("pointerup",()=>{var t,e;console.log("clicked"),this.isVisible=!this.isVisible,(t=this.crates)==null||t.setVisible(this.isVisible),(e=this.toggleVisibleButton)==null||e.setFrame(this.isVisible?1:0)}),this.toggleVisibleButton.setOrigin(.8))}getMaxScore(){let o=0,t=0;for(let e=0;e<this.gridData.height;e++)for(let s=0;s<this.gridData.width;s++){const n=this.gridData.gridObjects[e][s],r=this.gridData.gridObjectives[e][s];n==="none"||n==="crane"||o++,r==="none"||r==="crane"||t++}this.maxScore=Math.min(o,t)}placeBlocks(o){const t=this.scene.physics.add.group({collideWorldBounds:!0});for(let e=0;e<this.gridData.width;e++)for(let s=this.gridData.height-1;s>=0;s--)switch(console.log("test"),o?this.gridData.gridObjects[4-s][e]:this.gridData.gridObjectives[4-s][e]){case"none":break;case"crane":{this.crane=new g(this.scene,this.gridVars.GRID_START_LEFT+this.gridVars.GRID_SQUARE_SIZE*e,this.scene.sys.game.canvas.height-this.gridVars.GRID_START_BOTTOM-this.gridVars.GRID_SQUARE_SIZE*s,!1);break}case"crate-brown":{const n=new T(this.scene,this.gridVars.GRID_START_LEFT+this.gridVars.GRID_SQUARE_SIZE*e,this.scene.sys.game.canvas.height-this.gridVars.GRID_START_BOTTOM-this.gridVars.GRID_SQUARE_SIZE*s,"regCrate","brown");o||n.setAlpha(.5),n.refreshBody(),t.add(n.setPushable(!1));break}case"crate-red":{const n=new T(this.scene,this.gridVars.GRID_START_LEFT+this.gridVars.GRID_SQUARE_SIZE*e,this.scene.sys.game.canvas.height-this.gridVars.GRID_START_BOTTOM-this.gridVars.GRID_SQUARE_SIZE*s,"regCrate","red");n.refreshBody(),t.add(n.setPushable(!1));break}case"crate-green":{const n=new T(this.scene,this.gridVars.GRID_START_LEFT+this.gridVars.GRID_SQUARE_SIZE*e,this.scene.sys.game.canvas.height-this.gridVars.GRID_START_BOTTOM-this.gridVars.GRID_SQUARE_SIZE*s,"regCrate","green");n.refreshBody(),t.add(n.setPushable(!1));break}case"crate-blue":{const n=new T(this.scene,this.gridVars.GRID_START_LEFT+this.gridVars.GRID_SQUARE_SIZE*e,this.scene.sys.game.canvas.height-this.gridVars.GRID_START_BOTTOM-this.gridVars.GRID_SQUARE_SIZE*s,"regCrate","blue");n.refreshBody(),t.add(n.setPushable(!1));break}}return this.scene.physics.add.collider(t,t),this.crane!==void 0&&o&&this.scene.physics.add.collider(this.crane,t),t}}class h extends _.Scene{constructor(t="LevelScene"){super(t);i(this,"grid");i(this,"secondaryGrid");i(this,"left_blocks",0);i(this,"right_blocks",0);i(this,"up_blocks",0);i(this,"down_blocks",0);i(this,"grab_blocks",0);i(this,"release_blocks",0);i(this,"loop_blocks",0);i(this,"endloop_blocks",0);i(this,"number_blocks",[0]);i(this,"crates");i(this,"endCrates");i(this,"crane");i(this,"start_instruction");i(this,"score",0);i(this,"Instructions");i(this,"background")}get getCrane(){return this.crane}init(t){this.grid=new S(t.gridData,!0,this),this.secondaryGrid=new S(t.gridData,!1,this),this.up_blocks=t.gridData.up_blocks,this.left_blocks=t.gridData.left_blocks,this.right_blocks=t.gridData.right_blocks,this.down_blocks=t.gridData.down_blocks,this.grab_blocks=t.gridData.grab_blocks,this.release_blocks=t.gridData.release_blocks,this.loop_blocks=t.gridData.loop_blocks,this.endloop_blocks=t.gridData.endloop_blocks,this.number_blocks=t.gridData.number_blocks,this.createLevel()}createLevel(){this.background=this.add.image(this.sys.game.canvas.width/2,this.sys.game.canvas.height/2,"background"),this.background.setScale(this.sys.game.canvas.width,this.sys.game.canvas.height),this.grid.makeGrid(),this.crates=this.grid.crates,this.endCrates=this.grid.endCrates,this.crane=this.grid.crane,this.secondaryGrid.makeGrid();const t=document.getElementById("editor");console.log(t);const e=t.contentWindow;e.scene=this,this.generate_instructions();const s=this.add.rectangle(this.sys.game.canvas.width-80,this.sys.game.canvas.height-130,140,30,2113632,1);s.setInteractive(),s.on("pointerover",()=>{s.setFillStyle(2113632,.6)}),s.on("pointerout",()=>{s.setFillStyle(2113632,1)}),this.add.text(this.sys.game.canvas.width-80,this.sys.game.canvas.height-130,"execute!",{fontSize:"18px",color:"#fff"}).setOrigin(.5),s.on("pointerdown",()=>{console.log(this.InstructionChainToString()),this.execute(this.InstructionChainToString())});const r=this.add.rectangle(this.sys.game.canvas.width-80,this.sys.game.canvas.height-30,140,30,2113632,1);r.setInteractive(),r.on("pointerover",()=>{r.setFillStyle(2113632,.6)}),r.on("pointerout",()=>{r.setFillStyle(2113632,1)}),this.add.text(this.sys.game.canvas.width-80,this.sys.game.canvas.height-30,"main menu",{fontSize:"18px",color:"#fff"}).setOrigin(.5),r.on("pointerdown",()=>{this.scene.start("MainMenuScene")});const a=this.add.rectangle(this.sys.game.canvas.width-80,this.sys.game.canvas.height-80,140,30,2113632,1);a.setInteractive(),a.on("pointerover",()=>{a.setFillStyle(2113632,.6)}),a.on("pointerout",()=>{a.setFillStyle(2113632,1)}),this.add.text(this.sys.game.canvas.width-80,this.sys.game.canvas.height-80,"restart",{fontSize:"18px",color:"#fff"}).setOrigin(.5),a.on("pointerdown",()=>{this.scene.restart()})}update(){this.crane!==void 0&&(this.physics.overlap(this.crane.PICKUP_BOX,this.crates,(t,e)=>{this.crane!==void 0&&(this.crane.toGrab=e)})||(this.crane.toGrab=void 0)),this.checkWin()}checkOverlap(t,e){if(t.getColor()!==e.getColor())return!1;const s=Math.abs(e.body.position.x-t.body.position.x),n=Math.abs(e.body.position.y-t.body.position.y);return Math.sqrt(s*s+n*n)<6}getScore(){var t;this.score=0,(t=this.crates)==null||t.getChildren().forEach(e=>{var s;(s=this.endCrates)==null||s.getChildren().forEach(n=>{const r=e,l=n;this.checkOverlap(l,r)&&this.score++})},this)}checkWin(){this.getScore();const t=this.score===this.grid.maxScore;return t&&(console.log("you win!"),this.add.text(400,300,"YOU WIN!")),t}generate_instructions(){var l,a,u;let t=100,e=50;const s=new p(this,t,e,"start");this.add.existing(s),(l=this.Instructions)==null||l.push(s),this.start_instruction=s,e+=50;const n=[this.up_blocks,this.down_blocks,this.left_blocks,this.right_blocks,this.grab_blocks,this.release_blocks,this.loop_blocks,this.endloop_blocks],r=["up","down","left","right","grab","release","loop","endloop"];for(let d=0;d<n.length;d++)for(let b=0;b<n[d];b++){const v=new p(this,t,e,r[d]);this.add.existing(v),(a=this.Instructions)==null||a.push(v),e+=50,e>=400&&(t+=100,e=50)}for(let d=0;d<this.number_blocks.length;d++){const b=new p(this,t,e,"number",this.number_blocks[d]);this.add.existing(b),(u=this.Instructions)==null||u.push(b),e+=50,e>=400&&(t+=100,e=50)}}InstructionChainToString(){var e;let t=this.start_instruction;if(this.start_instruction){let s="";for(;(t==null?void 0:t.nextInstruction)!==void 0;)t=t.nextInstruction,s+=t.instructionType,t.instructionType==="loop"&&(s+=" "+((e=t.loopChild)==null?void 0:e.loopNumber)),s+=`
`;return console.log(s),s}return""}execute(t){const e=t,s=new x(e),n=new y(s),r=new R(n),a=new w(r).program(),u=new E(null,this);console.log(u.visit(a))}}i(h,"P_GRID_START_BOTTOM",16),i(h,"P_GRID_START_LEFT",16),i(h,"P_GRID_SQUARE_SIZE",32),i(h,"S_GRID_START_BOTTOM",16),i(h,"S_GRID_START_LEFT",300),i(h,"S_GRID_SQUARE_SIZE",32);class G extends _.Scene{constructor(){super({key:"LevelSelectScene"});i(this,"LEVELS",[{width:5,height:5,gridObjects:[["none","none","none","none","crane"],["none","none","none","none","none"],["none","none","none","none","none"],["none","none","none","none","none"],["crate-brown","crate-brown","crate-brown","none","none"]],gridObjectives:[["none","none","none","none","none"],["none","none","none","none","none"],["none","none","crate-brown","none","none"],["none","none","crate-brown","none","none"],["none","none","crate-brown","none","none"]],start_blocks:1,loop_blocks:2,endloop_blocks:2,left_blocks:6,right_blocks:6,down_blocks:6,up_blocks:6,grab_blocks:3,release_blocks:3,number_blocks:[1,2,3,4]},{width:5,height:5,gridObjects:[["none","none","none","none","crane"],["none","none","none","none","none"],["none","none","none","none","crate-red"],["crate-green","crate-red","crate-blue","none","crate-blue"],["crate-red","crate-blue","crate-green","none","crate-green"]],gridObjectives:[["none","none","none","none","none"],["none","none","none","none","none"],["crate-blue","crate-red","crate-green","none","none"],["crate-blue","crate-red","crate-green","none","none"],["crate-blue","crate-red","crate-green","none","none"]],start_blocks:1,loop_blocks:2,endloop_blocks:2,left_blocks:6,right_blocks:6,down_blocks:6,up_blocks:6,grab_blocks:3,release_blocks:3,number_blocks:[1,2,3,4]}])}create(){for(let t=0;t<this.LEVELS.length;t++){const e=this.add.rectangle(100+t%6*100,100+Math.floor(t/6)*100,80,80,2113632,1);e.setInteractive(),e.on("pointerover",()=>{e.setFillStyle(2113632,.6)}),e.on("pointerout",()=>{e.setFillStyle(2113632,1)}),this.add.text(100+t%6*100,100+Math.floor(t/6)*100,`${t}`,{fontSize:"40px",color:"#fff"}).setOrigin(.5),e.on("pointerdown",()=>{console.log(`level ${t} clicked`),this.scene.start("LevelScene",{levelNumber:t,gridData:this.LEVELS[t]})})}}}class C extends h{constructor(){super("TutorialLevelScene");i(this,"tutLevelData",{width:5,height:5,gridObjects:[["none","none","none","none","crane"],["none","none","none","none","none"],["none","none","none","none","none"],["none","none","none","none","none"],["crate-brown","none","none","none","none"]],gridObjectives:[["none","none","none","none","none"],["none","none","none","none","none"],["none","none","none","none","none"],["none","none","none","none","none"],["none","none","crate-brown","none","none"]],start_blocks:1,loop_blocks:2,endloop_blocks:2,left_blocks:6,right_blocks:6,down_blocks:6,up_blocks:6,grab_blocks:3,release_blocks:3,number_blocks:[1,2,3,4]});i(this,"tutorialTexts",[`Welcome to the tutorial level!
	Arrange the blocks by drag and drop, then click execute to control the crane.
	Use the close and open block to pick up and drop crates.
	Press the play button to start the level.
	Press the reset button to reset the level.
	Press the menu button to return to the level select screen.
	Press the help button to view this help message.
	
	Click here to continue.
	`,`The objective of the game is to move the crates to the objective tiles.*	
	Use the crane to move crate (opaque) to the objective tile (semi-transparent)
	 using the text (code) blocks.
	Now drag and drop the code blocks to the Start block and solve this level. :)

	Click here to dismiss this text.`])}init(){super.init({levelNumber:-1,gridData:this.tutLevelData})}create(){const t=this.add.text(400,300,this.tutorialTexts.shift(),{fontFamily:"Arial",fontSize:"24px",color:"#FFFFFF",align:"center",backgroundColor:"black"}).setOrigin(.5,.5);t.setInteractive(),t.on("pointerdown",()=>{const e=this.tutorialTexts.shift();e?t.setText(e):t.destroy()})}update(){super.update()}}class O extends Phaser.Scene{constructor(){super({key:"MainMenuScene"})}preload(){this.load.image("background","assets/TempBackground.png"),this.load.image("gridSquare","assets/GridSquare.png"),this.load.image("regCrate","assets/RegCrate.png"),this.load.image("craneOpen","assets/CraneBasicRed.png"),this.load.image("craneClosed","assets/CraneBasicGreen.png"),this.load.image("cranePickupBox","assets/CranePickupBox.png"),this.load.spritesheet("visibilityButton","assets/VisibilityButtons.png",{frameWidth:48,frameHeight:32}),this.load.image("instruction","assets/Instruction.png"),this.load.image("instruction-loop","assets/LoopInstruction.png"),this.load.image("instruction-number","assets/Instruction-number.png")}create(){this.add.text(this.game.config.width/2,100,"Build Blocks",{fontSize:"64px"}).setOrigin(.5);const t=this.add.rectangle(this.game.config.width/2,300,300,50,2113632);t.setInteractive(),t.on("pointerdown",()=>{this.scene.start("TutorialLevelScene")}),t.on("pointerover",()=>{t.setFillStyle(2113632,.6)}),t.on("pointerout",()=>{t.setFillStyle(2113632,1)}),this.add.text(this.game.config.width/2,300,"Tutorial Level",{fontSize:"32px"}).setOrigin(.5);const s=this.add.rectangle(this.game.config.width/2,400,300,50,2113632);s.setInteractive(),s.on("pointerdown",()=>{this.scene.start("LevelSelectScene")}),s.on("pointerover",()=>{s.setFillStyle(2113632,.6)}),s.on("pointerout",()=>{s.setFillStyle(2113632,1)}),this.add.text(this.game.config.width/2,400,"Level Select",{fontSize:"32px"}).setOrigin(.5)}}const M={type:_.AUTO,parent:"app",width:800,height:600,physics:{default:"arcade",arcade:{gravity:{y:300}}},scene:[O,G,C,h]};new _.Game(M);
